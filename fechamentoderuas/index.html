<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Fechamento de Ruas</title>
    
    <!-- Inclui o CSS do Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    
    <!-- Inclui o JS do Leaflet -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="/fechamentoderuas/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link
      href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
      rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="/fechamentoderuas/css/sb-admin-2.min.css" rel="stylesheet">

  <!-- Custom styles for this page -->
  <link href="/fechamentoderuas/vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">
    
    <style>
        #map {
            height: 600px;
            width: 100%;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
    </style>
</head>
<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <div class="container-fluid">
                    <div class="card-body">
                        <div id="map"></div>
                
                    
                    </div>
                
                </div>
                <script>
                    // Função para obter o valor de um parâmetro da URL
                    function getUrlParameter(name) {
                        const urlParams = new URLSearchParams(window.location.search);
                        return urlParams.get(name);
                    }
                
                    // Obtém o valor do parâmetro CONTROLE
                    const controleParam = getUrlParameter('CONTROLE');
                
                    // Inicializa o mapa com uma visualização padrão
                    var map = L.map('map').setView([-22.930781, -43.421142], 11);
                
                    // Adiciona uma camada de mapa (tile layer)
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                    }).addTo(map);
                
                    // Define um estilo para os pontos gerais
                    function defaultStyle(feature) {
                        return {
                            color: "#3388ff",
                            weight: 3
                        };
                    }
                
                    // Define um estilo especial para o ponto do CONTROLE selecionado
                    function highlightStyle(feature) {
                        return {
                            color: "#ff7800",
                            weight: 5,
                            opacity: 1
                        };
                    }
                
                    // Função para adicionar tooltip com informações do GeoJSON
                    function onEachFeature(feature, layer) {
                        if (feature.properties) {
                            var tooltipContent = "<strong>CONTROLE:</strong> " + feature.properties.CONTROLE + "<br>" +
                                                 "<strong>MONITOR:</strong> " + feature.properties.Planilha_1 + "<br>" +
                                                 "<strong>TIPO:</strong> " + feature.properties.Planilha_2 +  "<strong> NUMERO:</strong> " + feature.properties.Planilha_3 + "<br>" +
                                                 "<strong>DATA DO DOC.:</strong> " + feature.properties.Planilha_4 + "<br>" +
                                                 "<strong>Nº DA PORTARIA:</strong> " + feature.properties.Planilha_5 + "<br>" +
                                                 "<strong>DATA DA PORTARIA OU AUTORIZACAO:</strong> " + feature.properties.Planilha_6 + "<br>" +
                                                 "<strong>ORIGEM:</strong> " + feature.properties.Planilha_7 + "<br>" +
                                                 "<strong>STATUS:</strong> " + feature.properties.Planilha_8 + "<br>" +
                                                 "<strong>HISTORICO:</strong> " + feature.properties.Planilha_9 + "<br>" +
                                                 "<strong>LOGRADOURO:</strong> " + feature.properties.Planilha10 + "<br>" +
                                                 "<strong>REFERENCIA:</strong> " + feature.properties.Planilha11 + "<br>" +
                                                 "<strong>TIPO:</strong> " + feature.properties.Planilha12 + "<br>" +
                                                 "<strong>ENDEREÇO:</strong> " + feature.properties.Planilha13 + "<strong> BAIRRO:</strong> " + feature.properties.Planilha14 + "<br>" +
                                                 "<strong>AP:</strong> " + feature.properties.Planilha15 + "<br>" +
                                                 "<strong>SAIDA 1:</strong> " + feature.properties.Planilha16 + "<br>" +
                                                 "<strong>DESTINO 1:</strong> " + feature.properties.Planilha17 + "<br>" +
                                                 "<strong>RETORNO 1:</strong> " + feature.properties.Planilha18 + "<br>" +
                                                 "<strong>SAIDA 2:</strong> " + feature.properties.Planilha19 + "<br>" +
                                                 "<strong>DESTINO 2:</strong> " + feature.properties.Planilha20 + "<br>" +
                                                 "<strong>RETORNO 2:</strong> " + feature.properties.Planilha21 + "<br>" +
                                                 "<strong>SAIDA 3:</strong> " + feature.properties.Planilha22 + "<br>" +
                                                 "<strong>DESTINO 3:</strong> " + feature.properties.Planilha23 + "<br>" +
                                                 "<strong>RETORNO 3:</strong> " + feature.properties.Planilha24 + "<br>" +
                                                 "<strong>SAIDA 4:</strong> " + feature.properties.Planilha25 + "<br>" +
                                                 "<strong>DESTINO 4:</strong> " + feature.properties.Planilha26 + "<br>" +
                                                 "<strong>RETORNO 4:</strong> " + feature.properties.Planilha27 + "<br>" +
                                                 "<strong>SAIDA 5:</strong> " + feature.properties.Planilha28 + "<br>" +
                                                 "<strong>DESTINO 5:</strong> " + feature.properties.Planilha29;


                            layer.bindTooltip(tooltipContent);
                        }
                    }
                
                    // Carrega o arquivo GeoJSON
                    fetch('linhas.json')  
                        .then(response => response.json())
                        .then(data => {
                            // Adiciona todos os recursos ao mapa e aplica estilos
                            L.geoJSON(data, {
                                style: function(feature) {
                                    return feature.properties.CONTROLE == controleParam ? highlightStyle(feature) : defaultStyle(feature);
                                },
                                onEachFeature: onEachFeature
                            }).addTo(map);
                
                            // Localiza o recurso com o CONTROLE especificado e ajusta o zoom para focar nele
                            const selectedFeature = data.features.find(f => f.properties.CONTROLE == controleParam);
                            if (selectedFeature) {
                                const firstCoordinate = selectedFeature.geometry.coordinates[0][0];
                                map.setView([firstCoordinate[1], firstCoordinate[0]], 17);
                                
                                // Popula a tabela com todos os recursos e destaca o selecionado
                                populateTable(data.features, selectedFeature.properties.CONTROLE);
                            } else {
                                console.warn("Nenhum recurso encontrado para o CONTROLE especificado.");
                                populateTable(data.features);
                            }
                        })
                        .catch(error => {
                            console.error("Erro ao carregar o arquivo GeoJSON:", error);
                        });
                
                    // Função para preencher a tabela com dados e destacar o selecionado
                    function populateTable(features, selectedControle) {
                        const tbody = document.querySelector("#dataTable tbody");
                        tbody.innerHTML = '';
                
                        features.forEach(feature => {
                            if (feature.properties) {
                                const row = document.createElement("tr");
                                const processoCell = document.createElement("td");
                                const descricaoCell = document.createElement("td");
                
                                processoCell.textContent = feature.properties.Planilha_3;
                                descricaoCell.textContent = feature.properties.Planilha_5;
                
                                // Adiciona uma classe para destacar a linha correspondente ao CONTROLE
                                if (feature.properties.CONTROLE == selectedControle) {
                                    row.style.backgroundColor = "#ffdd99";  // Cor de destaque
                                }
                
                                row.appendChild(processoCell);
                                row.appendChild(descricaoCell);
                                tbody.appendChild(row);
                            }
                        });
                    }
                </script>
                
                
                



   <!-- Scroll to Top Button-->
   <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>


     <!-- Bootstrap core JavaScript-->
     <script src="/fechamentoderuas/vendor/jquery/jquery.min.js"></script>
     <script src="/fechamentoderuas/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
 
     <!-- Core plugin JavaScript-->
     <script src="/fechamentoderuas/vendor/jquery-easing/jquery.easing.min.js"></script>
 
     <!-- Custom scripts for all pages-->
     <script src="/fechamentoderuas/js/sb-admin-2.min.js"></script>
 
     <!-- Page level plugins -->
     <script src="/fechamentoderuas/vendor/datatables/jquery.dataTables.min.js"></script>
     <script src="/fechamentoderuas/vendor/datatables/dataTables.bootstrap4.min.js"></script>
 
     <!-- Page level custom scripts -->
     <script src="/fechamentoderuas/js/demo/datatables-demo.js"></script>
</body>
</html>